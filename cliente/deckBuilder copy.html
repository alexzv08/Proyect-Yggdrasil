<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/deckBuilder2.css">
    <!-- <script type="module" src="js/sideBar.js"></script> -->
    <script type="module" src="js/funcionesCartas.js"></script>

    <title>Document</title>
    <script>
        // @TODO
        // AL CLIKAR O AL HACER DROP REVISAR SI LA CARTA YA EXISTE EN EL MAZO Y MODIFICAR LA CANTIDAD DE ESA CARTA
        // SI NO ESTA LA CARTA EN EL MAZO AÑADIR EL CONTADOR DE CARTAS CON UN MAS Y MENOS [-|X|+] 
        // HACER QUE LOS BOTONES EN EL MAZO MODIFIQUE LA CANTIDAD DE CARTAS
        // OBLIGAR AL USUARIO A QUE GUARDE EL MAZO O QUE SE GUARDE AUTOMATICAMENTE, Y QUE AL SALIR DE ESA PESTAÑA INSERTAR EL MAZO O MODIFICARLO

        let elementoDrag;
        let mazo = {
            "eggDeck": {},
            "deck": {}
        };
        let mostarEstadisticasToogle = true;
        let mostarEstadisticasToogleMovil = true;
        // window.onload = async() => {
        //     // desplegaDetalle.addEventListener("click", ocultarEstadisticas)
        //     // desplegaDetalleMovil.addEventListener("click", ocultarEstadisticasMovil)
        //     // guardarMazoB.addEventListener("click" , guardarMazo)
        //     // guardarMazoBM.addEventListener("click" , guardarMazo)
        //     // limpiarMazoB.addEventListener("click" , limpiarMazo)
        //     imgCartas()
        // }

        function ocultarEstadisticas(){
            if(mostarEstadisticasToogle){
                detalles.style.display = "none"
                infoMazo.style.height = "10px"
                desplegaDetalle.style.top ="0px"
                mostarEstadisticasToogle =false
            }else{
                detalles.style.display = "flex"
                infoMazo.style.height = "120px"
                desplegaDetalle.style.top ="110px"
                mostarEstadisticasToogle =true
            }
        }
        function ocultarEstadisticasMovil(){
            if(mostarEstadisticasToogleMovil){
                detallesMovil.style.display = "none"
                infoMazoMovil.style.height = "0px"
                infoMazoMovil.style.margin = "0px"
                infoMazoMovil.style.padding = "0px"
                desplegaDetalleMovil.style.top ="0px"
                mostarEstadisticasToogleMovil =false
            }else{
                detallesMovil.style.display = "flex"
                infoMazoMovil.style.height = "270px"
                desplegaDetalleMovil.style.top ="255px"
                infoMazoMovil.style.padding = "10px"
                mostarEstadisticasToogleMovil =true
            }
        }

        // CARGA LA LISTA DE CARTAS FILTRADAS
        function imgCartas(){
            fetch("https://digimoncard.io/api-public/search.php?n=Agumon&sort=power&series=Digimon Card Game")
            .then(data => data.json())
            .then(data =>{
                console.log(data)
                data.forEach(element => {
                    cargarImg(element)
                });
                imgCard.src = data[0].image_url
            })  
        }
        // MOSTRAR TODAS LAS CARTAS 
        function cargarImg(element){
            let div = document.createElement("div")
            div.addEventListener("click", añadirCartaMazo)
            div.addEventListener("dragstart", drag(event))
            div.draggable="true"
            div.dataset.nombre =  element.name 
            div.dataset.cardnumber =  element.cardnumber 
            div.dataset.color =  element.color
            div.dataset.type =  element.type
            let img = document.createElement("img")
            img.src = element.image_url
            containerListaCartas.appendChild(div)
            div.appendChild(img)
        }

        let eggDeck = 0;
        let deck = 0;
        // function añadirCartaMazo() {
        //     dropZone.appendChild(this.cloneNode(true));
        //     if(this.dataset.type == "Egg"){
        //         mazo.eggDeck.push(this.dataset.cardnumber)
        //     }else{
        //         mazo.deck.push(this.dataset.cardnumber)
        //     }
        //     console.log(mazo)
        //     // if (this.dataset.type == "Digi-Egg" && eggDeck < 5) {
        //     //     if (typeof mazo["eggDeck"][this.dataset.cardnumber] !== 'number') {
        //     //         mazo["eggDeck"][this.dataset.cardnumber] = 0;
        //     //         actualizarDeck(this);
        //     //     }
        //     //     if (mazo["eggDeck"][this.dataset.cardnumber] < 4) {
        //     //         mazo["eggDeck"][this.dataset.cardnumber] += 1;
        //     //         eggDeck++;
        //     //         console.log(eggDeck);
        //     //         document.getElementById(this.dataset.cardnumber).innerText =  this.dataset.nombre + " " + this.dataset.cardnumber + " X "+mazo["eggDeck"][this.dataset.cardnumber]
        //     //     }
        //     // } else if(this.dataset.type != "Digi-Egg" && deck < 50){
        //     //     if (typeof mazo["deck"][this.dataset.cardnumber] !== 'number') {
        //     //         mazo["deck"][this.dataset.cardnumber] = 0;
        //     //         actualizarDeck(this);
        //     //     }
        //     //     if (mazo["deck"][this.dataset.cardnumber] < 4) {
        //     //         mazo["deck"][this.dataset.cardnumber] += 1;
        //     //         deck++;
        //     //         console.log(mazo["deck"]);
        //     //         document.getElementById(this.dataset.cardnumber).innerText =  this.dataset.nombre + " " + this.dataset.cardnumber + " X "+mazo["deck"][this.dataset.cardnumber]
        //     //     }
        //     // }
        // }

        function actualizarDeck(cardElement) {
            let div = document.createElement("div");
            div.style.backgroundColor = cardElement.dataset.color;
            div.id = cardElement.dataset.cardnumber
            listDeck.appendChild(div);
        }

        function guardarMazo(){
            for (const element in mazo.eggDeck) {
                sql = 'INSERT INTO listaCartasMazo ("idMazo", "DG","'+element.split("-")[0]+'", "'+element.split("-")[1]+'","'+mazo.eggDeck[element]+'")'  
                console.log(sql)
            }
        }
        function limpiarMazo(){
            if(deck>0 || eggDeck>0){
                if(window.confirm("Se va a limpiar el mazo. ¿Estas seguro?")){
                    listDeck.innerText = ''
                    deck=0
                    eggDeck=0
                    mazo["eggDeck"]=[]
                    mazo["deck"]=[]
                    console.log(mazo)
                }
            }
        }
    
        // REALIZAR EL DRAG AND DROP
        // function allowDrop(ev) {
        //     ev.preventDefault();
        // }
        // function drag(ev) {
        //     elementoDrag = this;
        // }
        // function drop(ev) {
        //     ev.preventDefault(); // Evitar el comportamiento predeterminado del evento drop
        //     ev.target.appendChild(elementoDrag.cloneNode(true));
        // }
    </script>
</head>
<body>
    <section id="main-container">

        <!-- ESCRITORIO -->
        <!-- FILTRO -->
        <div id="filtroEscritorio">
            <div id="cerrar"><div>X</div></div>
            <div><h2>Filtro cartas</h2></div>
            <form action="">

                <label for="">Palabra libre</label>
                <input type="text" placeholder="Palabra libre">

                <label for="">Nombre</label>
                <input type="text" placeholder="Nombre">

                <details class="detallesForm" id="FiltroEdicion">
                    <summary>Filtrar cartas por colección</summary>
                    <label>
                        BT-01<input type="checkbox" id="cbox1" value="first_checkbox" />
                    </label>
                    <label>
                        BT-02<input type="checkbox" id="cbox1" value="first_checkbox" />
                    </label>
                    <label>
                        BT-03<input type="checkbox" id="cbox1" value="first_checkbox" />
                    </label>
                </details>
  
                <div>
                    <details class="detallesForm" id="FiltroAvanzado">
                        <summary>Filtro avanzado</summary>
                        <div class="inputDetail">
                            <label for="">Numero de carta</label>
                            <input type="text" placeholder="Numero de carta">
                        </div>
                        <div class="inputDetail">
                            <label for="">Texo en la carta</label>
                            <input type="text" placeholder="Texo en la carta">
                        </div>
                        <div class="detailCheckbox">
                            <label for="">Rareza</label>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">C</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">U</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">R</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">SR</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">P</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">SEC</label>
                            </div>
                        </div>
                        <div class="detailCheckbox">
                            <label for="">Tipo de carta</label>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Egg</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Tamer</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Digimon</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Option</label>
                            </div>
                        </div>
                        <div class="detailCheckbox">
                            <label for="">LV</label>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">2</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">3</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">5</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">6</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">7</label>
                            </div>
                        </div>
                        <div class="detailCheckbox">
                            <label for="">Color</label>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Red</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Blue</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Yellow</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Green</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">White</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Black</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">purple</label>
                            </div>
                        </div>
                        <div class="inputDetail">
                            <label for="">Efecto al digivolucionar</label>
                            <input type="text" placeholder="Efecto al digivolucionar">
                        </div>
                        <div class="detailCheckbox">
                            <label for="">Forma</label>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">In-Train</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Rookie</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Champion</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Mega</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Armor Form</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Hybrid</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">D-Reaper</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Unknow</label>
                            </div>
                        </div>
                        <div class="detailCheckbox">
                            <label for="">Atributo</label>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Blue flare</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Ceraptosian</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Data</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Four great dragons</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Free</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Legend Arms</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Royal Knight</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Twilight</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Unidentifiedc</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">                           
                                <label for="">Unknow</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">                               
                                <label for="">Vaccine</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">                               
                                <label for="">Virus</label>
                            </div>
                            <div>
                                <input type="checkbox" name="" id="">
                                <label for="">Xros Heart</label>
                            </div>
                        </div>
                        <div>
                            <label for="">Rango DP</label>
                            <label for="">Min DP</label>
                            <input type="range" name="" id="" min="0" max="16000" value="0" step="1000">
                            <label for="">Max DP</label>
                            <input type="range" name="" id="" min="0" max="16000" value="16000" step="1000">
                        </div>
                        <div>
                            <label for="">Coste de juego</label>
                            <div class="inputDetail"> 
                                <input type="number" placeholder="Min" value="0">
                                <input type="number" placeholder="Max" value="30">
                            </div>
                        </div>
                    </details>
                </div>
                <div class="buttonsForm">
                    <button id="clear">Limpiar</button>
                    <button id="search">Buscar</button>
                </div>
            </form>
        </div>
        <div class="containerDeckBuilder">
            <div>
                <!-- <h1>Deck Builder</h1> -->
            </div>
            <div id="containerListaCartas"></div>
            <div id="containerListaMazo">
                <div id="info">
                    <h4>Arrastra o haz click para añadir cartas</h4>
                    <select name="" id="" >
                        <option style="color: black;" selected>Ordenar</option>
                        <option style="color: black;">LV. Orden Ascendente</option>
                        <option style="color: black;">LV. Orden Descendente</option>
                        <option style="color: black;">Color Orden Ascendente</option>
                        <option style="color: black;">Color Orden Descendente</option>
                        <option style="color: black;">Tipo de carta Orden Ascendente</option>
                        <option style="color: black;">Tipo de carta Orden Descendente</option>
                    </select>
                </div>
                <div id="mazo">
                    <div class="tipoMazo">
                        <div class="active">Main Deck</div>
                        <div>Egg Deck</div>
                    </div>
                    <div class="cont">
                        <div id="dropZone"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- MOVIL -->
        <!-- <div id="filtroCartas">
            <img src="" alt="">
            <h2>Filtrar cartas</h2>
        </div> -->
    </section>
</body>
</html>