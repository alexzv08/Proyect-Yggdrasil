<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/deckBuilder.css">
    <script type="module" src="js/sideBar.js"></script>
    <script type="module" src="js/funcionesCartas.js"></script>

    <title>Document</title>
    <script>
        
        let mazo = {
            "eggDeck": {},
            "deck": {}
        };
        let mostarEstadisticasToogle = true;
        let mostarEstadisticasToogleMovil = true;
        window.onload = async() => {
            desplegaDetalle.addEventListener("click", ocultarEstadisticas)
            desplegaDetalleMovil.addEventListener("click", ocultarEstadisticasMovil)
            guardarMazoB.addEventListener("click" , guardarMazo)
            guardarMazoBM.addEventListener("click" , guardarMazo)
            limpiarMazoB.addEventListener("click" , limpiarMazo)
            imgCartas()
        }

        function ocultarEstadisticas(){
            if(mostarEstadisticasToogle){
                detalles.style.display = "none"
                infoMazo.style.height = "10px"
                desplegaDetalle.style.top ="0px"
                mostarEstadisticasToogle =false
            }else{
                detalles.style.display = "flex"
                infoMazo.style.height = "120px"
                desplegaDetalle.style.top ="110px"
                mostarEstadisticasToogle =true

            }
        }
        function ocultarEstadisticasMovil(){
            if(mostarEstadisticasToogleMovil){
                detallesMovil.style.display = "none"
                infoMazoMovil.style.height = "0px"
                infoMazoMovil.style.margin = "0px"
                infoMazoMovil.style.padding = "0px"
                desplegaDetalleMovil.style.top ="0px"
                mostarEstadisticasToogleMovil =false
            }else{
                detallesMovil.style.display = "flex"
                infoMazoMovil.style.height = "270px"
                desplegaDetalleMovil.style.top ="255px"
                infoMazoMovil.style.padding = "10px"
                mostarEstadisticasToogleMovil =true
            }
        }

        function imgCartas(){
            fetch("https://digimoncard.io/api-public/search.php?n=Agumon&sort=power&series=Digimon Card Game")
            .then(data => data.json())
            .then(data =>{
                console.log(data)
                data.forEach(element => {
                    cargarImg(element)
                });
                imgCard.src = data[0].image_url
            })  
        }
        
        function cargarImg(element){
            let div = document.createElement("div")
            div.addEventListener("click", añadirCartaMazo)
            div.dataset.nombre =  element.name 
            div.dataset.cardnumber =  element.cardnumber 
            div.dataset.color =  element.color
            div.dataset.type =  element.type
            let img = document.createElement("img")
            img.src = element.image_url
            containerCartas.appendChild(div)
            div.appendChild(img)
        }

        let eggDeck = 0;
        let deck = 0;
        function añadirCartaMazo() {
            if (this.dataset.type == "Digi-Egg" && eggDeck < 5) {
                if (typeof mazo["eggDeck"][this.dataset.cardnumber] !== 'number') {
                    mazo["eggDeck"][this.dataset.cardnumber] = 0;
                    actualizarDeck(this);
                }
                if (mazo["eggDeck"][this.dataset.cardnumber] < 4) {
                    mazo["eggDeck"][this.dataset.cardnumber] += 1;
                    eggDeck++;
                    console.log(eggDeck);
                    document.getElementById(this.dataset.cardnumber).innerText =  this.dataset.nombre + " " + this.dataset.cardnumber + " X "+mazo["eggDeck"][this.dataset.cardnumber]
                }
            } else if(this.dataset.type != "Digi-Egg" && deck < 50){
                if (typeof mazo["deck"][this.dataset.cardnumber] !== 'number') {
                    mazo["deck"][this.dataset.cardnumber] = 0;
                    actualizarDeck(this);
                }
                if (mazo["deck"][this.dataset.cardnumber] < 4) {
                    mazo["deck"][this.dataset.cardnumber] += 1;
                    deck++;
                    console.log(mazo["deck"]);
                    document.getElementById(this.dataset.cardnumber).innerText =  this.dataset.nombre + " " + this.dataset.cardnumber + " X "+mazo["deck"][this.dataset.cardnumber]
                }
            }
        }

        function actualizarDeck(cardElement) {
            let div = document.createElement("div");
            div.style.backgroundColor = cardElement.dataset.color;
            div.id = cardElement.dataset.cardnumber
            listDeck.appendChild(div);
        }

        function guardarMazo(){
            for (const element in mazo.eggDeck) {
                sql = 'INSERT INTO listaCartasMazo ("idMazo", "DG","'+element.split("-")[0]+'", "'+element.split("-")[1]+'","'+mazo.eggDeck[element]+'")'  
                console.log(sql)
            }
        }
        function limpiarMazo(){
            if(deck>0 || eggDeck>0){
                if(window.confirm("Se va a limpiar el mazo. ¿Estas seguro?")){
                    listDeck.innerText = ''
                    deck=0
                    eggDeck=0
                    mazo["eggDeck"]=[]
                    mazo["deck"]=[]
                    console.log(mazo)
                }
            }
        }
    </script>
</head>
<body>
    <section id="main-container">

        <!-- ESCRITORIO -->
        <!-- FILTRO -->
        <div id="filtroEscritorio">
            <div>X</div>
            <div><h2>Filtro cartas</h2></div>
            <form action="">
                <label for="">Palabra libre</label>
                <input type="text" placeholder="Palabra libre">

                <label for="">Nombre</label>
                <input type="text" placeholder="Nombre">

                <input type="checkbox" name="" id="">
                <label for="">Filtrar cartas en colección</label>

                <details>
                    <summary>Edicion de carta</summary>

                    <input type="checkbox" name="" id="">
                    <label for="">BT-01</label>
                    <input type="checkbox" name="" id="">
                    <label for="">BT-02</label>
                    <input type="checkbox" name="" id="">
                    <label for="">BT-03</label>
                </details>
                
                <details>
                    <summary>Filtro avanzado</summary>

                    <label for="">Numero de carta</label>
                    <input type="text" placeholder="Numero de carta">
                    
                    <label for="">Texo en la carta</label>
                    <input type="text" placeholder="Texo en la carta">

                    <label for="">Rareza</label>
                    <label for="">C</label><input type="checkbox" name="" id="">
                    <label for="">U</label><input type="checkbox" name="" id="">
                    <label for="">R</label><input type="checkbox" name="" id="">
                    <label for="">SR</label><input type="checkbox" name="" id="">
                    <label for="">P</label><input type="checkbox" name="" id="">
                    <label for="">SEC</label><input type="checkbox" name="" id="">

                    <label for="">Tipo de carta</label>
                    <label for="">Egg</label><input type="checkbox" name="" id="">
                    <label for="">Tamer</label><input type="checkbox" name="" id="">
                    <label for="">Digimon</label><input type="checkbox" name="" id="">
                    <label for="">Option</label><input type="checkbox" name="" id="">

                    <label for="">LV</label>
                    <label for="">2</label><input type="checkbox" name="" id="">
                    <label for="">3</label><input type="checkbox" name="" id="">
                    <label for="">5</label><input type="checkbox" name="" id="">
                    <label for="">6</label><input type="checkbox" name="" id="">
                    <label for="">7</label><input type="checkbox" name="" id="">

                    <label for="">Color</label>
                    <label for="">Red</label><input type="checkbox" name="" id="">
                    <label for="">Blue</label><input type="checkbox" name="" id="">
                    <label for="">Yellow</label><input type="checkbox" name="" id="">
                    <label for="">Green</label><input type="checkbox" name="" id="">
                    <label for="">White</label><input type="checkbox" name="" id="">
                    <label for="">Black</label><input type="checkbox" name="" id="">
                    <label for="">purple</label><input type="checkbox" name="" id="">

                    <label for="">Efecto al digivolucionar</label>
                    <input type="text" placeholder="Efecto al digivolucionar">

                    <label for="">Forma</label>
                    <label for="">In-Train</label><input type="checkbox" name="" id="">
                    <label for="">Rookie</label><input type="checkbox" name="" id="">
                    <label for="">Champion</label><input type="checkbox" name="" id="">
                    <label for="">Mega</label><input type="checkbox" name="" id="">
                    <label for="">Armor Form</label><input type="checkbox" name="" id="">
                    <label for="">Hybrid</label><input type="checkbox" name="" id="">
                    <label for="">D-Reaper</label><input type="checkbox" name="" id="">
                    <label for="">Unknow</label><input type="checkbox" name="" id="">

                    <label for="">Atributo</label>
                    <label for="">Blue flare</label><input type="checkbox" name="" id="">
                    <label for="">Ceraptosian</label><input type="checkbox" name="" id="">
                    <label for="">Data</label><input type="checkbox" name="" id="">
                    <label for="">Four great dragons</label><input type="checkbox" name="" id="">
                    <label for="">Free</label><input type="checkbox" name="" id="">
                    <label for="">Legend Arms</label><input type="checkbox" name="" id="">
                    <label for="">Royal Knight</label><input type="checkbox" name="" id="">
                    <label for="">Twilight</label><input type="checkbox" name="" id="">
                    <label for="">Unidentifiedc</label><input type="checkbox" name="" id="">
                    <label for="">Unknow</label><input type="checkbox" name="" id="">
                    <label for="">Vaccine</label><input type="checkbox" name="" id="">
                    <label for="">Virus</label><input type="checkbox" name="" id="">
                    <label for="">Xros Heart</label><input type="checkbox" name="" id="">

                    <label for="">Rango DP</label>
                    <label for="">Min DP</label>
                    <input type="range" name="" id="" min="0" max="16000" value="0" step="1000">
                    <label for="">Max DP</label>
                    <input type="range" name="" id="" min="0" max="16000" value="16000" step="1000">

                    <label for="">Coste de juego</label>
                    <div>
                        <input type="text" placeholder="Min" value="0">
                        <input type="text" placeholder="Max" value="30">
                    </div>
                </details>
                <button id="clear">Limpiar</button>
                <button id="search">Buscar</button>
            </form>
        </div>
        <div class="containerDeckBuilder">
            <div>
                <h1>Deck Builder</h1>
            </div>
            <div id="containerListaCartas"></div>
            <div id="containerListaMazo">
                <div>
                    <h4>Arrastra o haz click para añadir cartas</h4>
                    <select name="" id="" >
                        <option disabled selected>Ordenar</option>
                        <option disabled selected>LV. Orden Ascendente</option>
                        <option disabled selected>LV. Orden Descendente</option>
                        <option disabled selected>Color Orden Ascendente</option>
                        <option disabled selected>Color Orden Descendente</option>
                        <option disabled selected>Tipo de carta Orden Ascendente</option>
                        <option disabled selected>Tipo de carta Orden Descendente</option>
                    </select>
                </div>
                <div>
                    <div>Main Deck</div>
                    <div>Egg Deck</div>
                    <div id="dropZone"></div>
                </div>
            </div>
        </div>
        <!-- MOVIL -->
        <div id="filtroCartas">
            <img src="" alt="">
            <h2>Filtrar cartas</h2>
        </div>
    </section>
</body>
</html>